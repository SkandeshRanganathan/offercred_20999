<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Text Selector</title>
    <style>
        /* Your CSS remains the same */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow: hidden;
        }
        
        .container {
            max-width: 1400px;
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        header {
            text-align: center;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .upload-instructions {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            transition: opacity 0.3s ease;
        }
        
        .upload-box {
            width: 100%;
            max-width: 600px;
            background-color: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        }
        
        .instructions-box {
            width: 100%;
            max-width: 600px;
            background-color: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
        }
        
        .drop-zone {
            width: 100%;
            height: 200px;
            border: 3px dashed #3498db;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            background-color: #f8f9fa;
            transition: all 0.3s ease;
        }
        
        .drop-zone:hover {
            background-color: #e8f4ff;
            border-color: #2980b9;
            transform: translateY(-2px);
        }
        
        .drop-zone p {
            margin: 0;
            color: #7f8c8d;
            font-size: 16px;
            text-align: center;
            padding: 0 15px;
        }
        
        .drop-zone .icon {
            font-size: 40px;
            color: #3498db;
            margin-bottom: 15px;
        }
        
        .file-input {
            display: none;
        }
        
        .main-content {
            display: none; /* Initially hidden */
            gap: 20px;
            height: 70vh;
        }
        
        .preview-section {
            flex: 3.3; /* Increased by 10% */
            background-color: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .tools-section {
            flex: 2;
            background-color: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }
        
        .btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: background-color 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            background-color: #2980b9;
        }
        
        .btn:disabled {
            background-color: #95a5a6;
            cursor: not-allowed;
        }
        
        .pdf-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: center;
        }
        
        .page-navigation {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .page-info {
            font-weight: 500;
            color: #2c3e50;
        }
        
        #pdf-container {
            flex: 1;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: auto;
            position: relative;
            background-color: #f8f9fa;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 15px;
            max-height: 60vh;
        }
        
        .pdf-viewport {
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        #pdf-render {
            position: absolute;
            top: 0;
            left: 0;
        }
        
        .text-layer {
            position: absolute;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            line-height: 1.0;
            user-select: none;
        }
        
        .text-layer span {
            color: transparent;
            position: absolute;
            white-space: pre;
            cursor: text;
            transform-origin: 0% 0%;
        }
        
        .text-selection-panel {
            margin-top: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            border-left: 4px solid #3498db;
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .text-selection-panel h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        #selected-text {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            min-height: 120px;
            flex: 1;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            white-space: pre-wrap;
            margin-bottom: 15px;
        }
        
        .selection-tools {
            display: flex;
            gap: 10px;
        }
        
        .selection-btn {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
            flex: 1;
        }
        
        .selection-btn:hover {
            background-color: #27ae60;
        }
        
        .clear-btn {
            background-color: #e74c3c;
        }
        
        .clear-btn:hover {
            background-color: #c0392b;
        }
        
        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .instructions ul {
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 8px;
        }
        
        .verification-results {
            margin-top: 20px;
            background-color: #e8f4ff;
            border-radius: 8px;
            padding: 15px;
            flex: 1;
            overflow-y: auto;
            display: none;
        }
        
        .verification-results h3 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        #verification-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .verification-item {
            background-color: white;
            padding: 12px;
            border-radius: 6px;
        }
        
        .verified {
            border-left: 4px solid #2ecc71;
        }
        
        .not-verified {
            border-left: 4px solid #e74c3c;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .selection-area {
            position: absolute;
            background-color: rgba(0, 0, 255, 0.1);
            border: 1px solid blue;
            pointer-events: none;
            z-index: 10;
        }
        
        .text-highlight {
            background-color: rgba(255, 255, 0, 0.3);
            border-radius: 2px;
        }

        .hidden {
            display: none !important;
        }

        .visible {
            display: flex !important;
        }

        @media (max-width: 1100px) {
            .main-content {
                flex-direction: column;
                height: auto;
            }
            
            #pdf-container {
                max-height: 50vh;
            }
        }
    </style>
    <!-- PDF.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
</head>
<body>
    <div class="container" style="margin-top: 20px;">
        <header>
            <h1>Resume Text Selector</h1>
            <p>Upload your resume PDF and select text like Google Lens</p>
        </header>
        
        <div class="upload-instructions" id="upload-instructions">
            <div class="upload-box">
                <h2>Upload Resume</h2>
                <div class="drop-zone" id="drop-zone">
                    <div class="icon">📄</div>
                    <p>Drag & drop your PDF resume here<br>or click to select</p>
                    <input type="file" id="file-input" class="file-input" accept=".pdf">
                </div>
            </div>
            
        </div>
        
        <div class="main-content" id="main-content">
            <div class="preview-section">
                <h2>Resume Preview</h2>
                
                <div class="pdf-controls">
                    <div class="page-navigation">
                        <button class="btn" id="prev-page"><i>←</i> Previous</button>
                        <span class="page-info">Page <span id="page-num">1</span> of <span id="page-count">1</span></span>
                        <button class="btn" id="next-page">Next <i>→</i></button>
                    </div>
                </div>
                
                <div id="pdf-container">
                    <div class="loading" id="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading PDF...</p>
                    </div>
                    <div class="pdf-viewport" id="pdf-viewport">
                        <canvas id="pdf-render"></canvas>
                        <div class="text-layer" id="text-layer"></div>
                        <div class="selection-area" id="selection-area" style="display: none;"></div>
                    </div>
                </div>
            </div>
            
            <div class="tools-section">
                <div class="text-selection-panel">
                    <h3>Selected Text</h3>
                    <div id="selected-text">No text selected yet. Select text from the PDF on the left.</div>
                    
                    <div class="selection-tools">
                         <button class="selection-btn" id="verifyBtn">Verify Credentials</button>
                        <button class="selection-btn clear-btn" id="clear-btn">Clear Selection</button>
                    </div>
                </div>

                <div class="verification-results" id="verification-results">
                    <h3>Verification Results</h3>
                    <div id="verification-container">
                        <!-- Verification results will be added here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
    // Set PDF.js worker path
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
    
    // DOM elements
    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('file-input');
    const pdfContainer = document.getElementById('pdf-container');
    const pdfViewport = document.getElementById('pdf-viewport');
    const pdfRender = document.getElementById('pdf-render');
    const textLayer = document.getElementById('text-layer');
    const selectionArea = document.getElementById('selection-area');
    const prevPageBtn = document.getElementById('prev-page');
    const nextPageBtn = document.getElementById('next-page');
    const pageNumber = document.getElementById('page-num');
    const pageCount = document.getElementById('page-count');
    const selectedTextDiv = document.getElementById('selected-text');
    const loadingDiv = document.getElementById('loading');
    const verifyBtn = document.getElementById('verifyBtn');
    const clearBtn = document.getElementById('clear-btn');
    const verificationResults = document.getElementById('verification-results');
    const verificationContainer = document.getElementById('verification-container');
    const uploadInstructions = document.getElementById('upload-instructions');
    const mainContent = document.getElementById('main-content');
    
    // PDF state
    let pdfDoc = null;
    let pageNum = 1;
    let scale = 1.2;
    let currentTextContent = null;
    let isSelecting = false;
    let selectionStartX, selectionStartY;

    // Array of verified credentials
    const verifiedCredentials = [
        "Cloud foundation - AWS", " Cloud foundation- AWS", "Cloud foundation - AWS", "Cloud foundation-AWS","Cloud foundation -AWS", "Cloud foundation -  AWS",
        "Cisco- Networking Basics- Cisco","Cisco- Networking Basics- Cisco","Cisco - Networking Basics - Cisco", "Cisco-Networking Basics-Cisco"
    ];
    
    // Make the selected text area editable
    selectedTextDiv.contentEditable = true;
    selectedTextDiv.style.minHeight = '100px';
    selectedTextDiv.style.whiteSpace = 'pre-wrap';
    
    // Click to open file selector
    dropZone.addEventListener('click', () => fileInput.click());
    
    // Handle file selection
    fileInput.addEventListener('change', (e) => {
        if (e.target.files.length > 0) {
            loadPDF(e.target.files[0]);
        }
    });
    
    // Handle drag and drop
    dropZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropZone.style.backgroundColor = '#e3f2fd';
        dropZone.style.borderColor = '#2980b9';
    });
    
    dropZone.addEventListener('dragleave', (e) => {
        e.preventDefault();
        dropZone.style.backgroundColor = '#f8f9fa';
        dropZone.style.borderColor = '#3498db';
    });
    
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault();
        dropZone.style.backgroundColor = '#f8f9fa';
        dropZone.style.borderColor = '#3498db';
        
        if (e.dataTransfer.files.length > 0) {
            loadPDF(e.dataTransfer.files[0]);
        }
    });

    // Verify credentials button
    verifyBtn.addEventListener('click', () => {
        verifyCredentials();
    });
    
    // Load PDF file
    function loadPDF(file) {
        if (file.type !== 'application/pdf') {
            alert('Please upload a PDF file');
            return;
        }
        
        loadingDiv.style.display = 'block';
        selectedTextDiv.textContent = 'No text selected yet. Select text from the PDF on the left.';
        verificationResults.style.display = 'none';
        
        const fileReader = new FileReader();
        
        fileReader.onload = function(event) {
            const typedarray = new Uint8Array(event.target.result);
            
            pdfjsLib.getDocument(typedarray).promise.then(pdf => {
                pdfDoc = pdf;
                pageCount.textContent = pdf.numPages;
                renderPage(pageNum);
                
                // Hide upload instructions and show main content after successful PDF loading
                uploadInstructions.classList.add('hidden');
                mainContent.classList.add('visible');
            }).catch(error => {
                console.error('Error loading PDF:', error);
                alert('Error loading PDF. Please try another file.');
                loadingDiv.style.display = 'none';
            });
        };
        
        fileReader.readAsArrayBuffer(file);
    }
    
    // Render PDF page
    function renderPage(num) {
        pageNum = num;
        pageNumber.textContent = num;
        
        // Update button states
        prevPageBtn.disabled = num <= 1;
        nextPageBtn.disabled = num >= pdfDoc.numPages;
        
        // Get page
        pdfDoc.getPage(num).then(page => {
            const viewport = page.getViewport({ scale });
            
            // Prepare canvas
            const canvas = pdfRender;
            const context = canvas.getContext('2d');
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            
            // Set viewport dimensions
            pdfViewport.style.width = `${viewport.width}px`;
            pdfViewport.style.height = `${viewport.height}px`;
            
            // Render PDF
            const renderContext = {
                canvasContext: context,
                viewport: viewport
            };
            
            page.render(renderContext).promise.then(() => {
                // Get text content for text layer
                return page.getTextContent();
            }).then(textContent => {
                currentTextContent = textContent;
                // Render text layer using PDF.js's built-in method
                renderTextLayer(textContent, viewport);
                loadingDiv.style.display = 'none';
                
                // Setup selection after rendering
                setupSelection();
            }).catch(error => {
                console.error('Error rendering PDF:', error);
                loadingDiv.style.display = 'none';
            });
        });
    }
    
    // Render text layer for selection using PDF.js's method
    function renderTextLayer(textContent, viewport) {
        // Clear previous text layer
        textLayer.innerHTML = '';
        textLayer.style.width = `${viewport.width}px`;
        textLayer.style.height = `${viewport.height}px`;
        
        // Create text elements for each text item using PDF.js's method
        pdfjsLib.renderTextLayer({
            textContent: textContent,
            container: textLayer,
            viewport: viewport,
            textDivs: []
        });
    }
    
    // Setup custom selection
    function setupSelection() {
        const textSpans = textLayer.querySelectorAll('span');
        
        // Add event listeners for custom selection
        pdfViewport.addEventListener('mousedown', startSelection);
        pdfViewport.addEventListener('mousemove', updateSelection);
        pdfViewport.addEventListener('mouseup', endSelection);
    }
    
    // Start selection
    function startSelection(e) {
        if (e.button !== 0) return; // Only left mouse button
        
        isSelecting = true;
        const rect = pdfViewport.getBoundingClientRect();
        selectionStartX = e.clientX - rect.left;
        selectionStartY = e.clientY - rect.top;
        
        selectionArea.style.left = `${selectionStartX}px`;
        selectionArea.style.top = `${selectionStartY}px`;
        selectionArea.style.width = '0px';
        selectionArea.style.height = '0px';
        selectionArea.style.display = 'block';
        
        e.preventDefault();
    }
    
    // Update selection
    function updateSelection(e) {
        if (!isSelecting) return;
        
        const rect = pdfViewport.getBoundingClientRect();
        const currentX = e.clientX - rect.left;
        const currentY = e.clientY - rect.top;
        
        const left = Math.min(selectionStartX, currentX);
        const top = Math.min(selectionStartY, currentY);
        const width = Math.abs(currentX - selectionStartX);
        const height = Math.abs(currentY - selectionStartY);
        
        selectionArea.style.left = `${left}px`;
        selectionArea.style.top = `${top}px`;
        selectionArea.style.width = `${width}px`;
        selectionArea.style.height = `${height}px`;
    }
    
    // End selection and get text
    function endSelection(e) {
        if (!isSelecting) return;
        
        isSelecting = false;
        selectionArea.style.display = 'none';
        
        const rect = pdfViewport.getBoundingClientRect();
        const endX = e.clientX - rect.left;
        const endY = e.clientY - rect.top;
        
        const left = Math.min(selectionStartX, endX);
        const top = Math.min(selectionStartY, endY);
        const right = Math.max(selectionStartX, endX);
        const bottom = Math.max(selectionStartY, endY);
        
        // Get selected text based on selection area
        const selectedText = getTextFromSelectionArea(left, top, right, bottom);
        
        if (selectedText) {
            selectedTextDiv.textContent = selectedText;
            
            // Highlight the selected text
            highlightSelectedText(left, top, right, bottom);
        }
    }
    
    // Get text from selection area
    function getTextFromSelectionArea(left, top, right, bottom) {
        const textSpans = textLayer.querySelectorAll('span');
        let selectedText = '';
        let lastBottom = -1;
        
        // Sort spans by their vertical position
        const sortedSpans = Array.from(textSpans).sort((a, b) => {
            const aRect = a.getBoundingClientRect();
            const bRect = b.getBoundingClientRect();
            const containerRect = pdfViewport.getBoundingClientRect();
            
            const aTop = aRect.top - containerRect.top;
            const bTop = bRect.top - containerRect.top;
            
            return aTop - bTop || (aRect.left - containerRect.left) - (bRect.left - containerRect.left);
        });
        
        for (const span of sortedSpans) {
            const spanRect = span.getBoundingClientRect();
            const containerRect = pdfViewport.getBoundingClientRect();
            
            const spanLeft = spanRect.left - containerRect.left;
            const spanTop = spanRect.top - containerRect.top;
            const spanRight = spanLeft + spanRect.width;
            const spanBottom = spanTop + spanRect.height;
            
            // Check if span is within selection area
            if (spanRight > left && spanLeft < right && spanBottom > top && spanTop < bottom) {
                // Use semicolons to separate text instead of line breaks
                if (lastBottom !== -1 && spanTop > lastBottom + 5) {
                    selectedText += '; ';
                }
                
                selectedText += span.textContent + ' ';
                lastBottom = spanBottom;
            }
        }
        
        return selectedText.trim();
    }
    
    // Highlight selected text
    function highlightSelectedText(left, top, right, bottom) {
        // Clear previous highlights
        const textSpans = textLayer.querySelectorAll('span');
        textSpans.forEach(span => span.classList.remove('text-highlight'));
        
        // Add highlights to selected spans
        for (const span of textSpans) {
            const spanRect = span.getBoundingClientRect();
            const containerRect = pdfViewport.getBoundingClientRect();
            
            const spanLeft = spanRect.left - containerRect.left;
            const spanTop = spanRect.top - containerRect.top;
            const spanRight = spanLeft + spanRect.width;
            const spanBottom = spanTop + spanRect.height;
            
            // Check if span is within selection area
            if (spanRight > left && spanLeft < right && spanBottom > top && spanTop < bottom) {
                span.classList.add('text-highlight');
            }
        }
    }

    // Verify credentials function
    function verifyCredentials() {
        const text = selectedTextDiv.textContent;
        
        if (!text || text === 'No text selected yet. Select text from the PDF on the left.') {
            alert('Please select some text first.');
            return;
        }
        
        // Split text by semicolons
        const sentences = text.split(';').map(s => s.trim()).filter(s => s.length > 0);
        
        // Clear previous verification results
        verificationContainer.innerHTML = '';
        verificationResults.style.display = 'block';
        
        if (sentences.length === 0) {
            const noResults = document.createElement('div');
            noResults.className = 'verification-item';
            noResults.textContent = 'No sentences found.';
            verificationContainer.appendChild(noResults);
            return;
        }
        
        // Check each sentence against verified credentials
        sentences.forEach(sentence => {
            const isVerified = verifiedCredentials.some(cred => 
                sentence.toLowerCase().includes(cred.toLowerCase())
            );
            
            const resultItem = document.createElement('div');
            resultItem.className = `verification-item ${isVerified ? 'verified' : 'not-verified'}`; // Fixed syntax error here
            resultItem.textContent = isVerified 
                ? `${sentence} is verified` 
                : `${sentence} is not verified`;
                
            verificationContainer.appendChild(resultItem);
        });
        
        // Clear the selected text and replace with verification results
        selectedTextDiv.style.display = 'none';
        verificationResults.style.marginTop = '0';
    }
    
    // Navigation buttons
    prevPageBtn.addEventListener('click', () => {
        if (pageNum > 1) {
            renderPage(pageNum - 1);
        }
    });
    
    nextPageBtn.addEventListener('click', () => {
        if (pageNum < pdfDoc.numPages) {
            renderPage(pageNum + 1);
        }
    });
    
    // Clear selection
    clearBtn.addEventListener('click', () => {
        selectedTextDiv.textContent = 'No text selected yet. Select text from the PDF on the left.';
        selectedTextDiv.style.display = 'block';
        verificationResults.style.display = 'none';
        verificationResults.style.marginTop = '20px';
        
        // Clear highlights
        const textSpans = textLayer.querySelectorAll('span');
        textSpans.forEach(span => span.classList.remove('text-highlight'));
    });
    
    // Initial state
    prevPageBtn.disabled = true;
    nextPageBtn.disabled = true;

</script>
</body>
</html>